Info on how a linux system starts running.

Summary of the boot process: <http://www.ibm.com/developerworks/library/l-linuxboot/>

# BIOS

TODO

# bootloading

Bootloading is the name of the process for starting up the system.

There are a few programs that can do that.

The most popular bootloader for Linux now is Grub. LILO was a popular alternative in the past.

Windows has its own bootloader.

BIOS tries to find in all devices (hard disk, cd/dvd, flash drives, floppies, ...)
it can see for a Master Boot Record (MBR).

In normal desktop operation nowadays, the hard disk is the main MBR source,
but when you install your OS, you must either use a cd / dvd or a flsh drive.

The MRB is the first 512 sector of the device found. It contains:

- a small piece of code (446 bytes) called the primary boot loader.

    This code will then be executed.

- the partition table (64 bytes) describing the primary and extended partitions

    TODO

It takes the fisrt MBR it finds.

The MBR can only be at the start of a physical partiion, not of a logical partion.
This is why on bootloader configurations you give /dev/sda, instead of /dev/sda1-4 (TODO check)

The search order is deterministic and configurable.
The first initial black screen is shown by BIOS.
If you are quick enough on you keyboard, you can stop the default boot,
and enter BIOS options to choose for example which device to take MBR from.
This way you can tell your BIOS to take a live CD or USB even if the OS
is installed on the hard disk (usually default location to take MBR from).

# grub

Grand Unified Bootloader.

If you have a dual boot, and you see a menu prompting you to choose the OS,
there is a good chance that this is GRUB working.

As you can see, it is quite a flexible piece of software, since it allows you
basic graphical interaction even before starting any OS!

also everything is configurable, from the menu entries to the background image!
(reason why Ubuntu GRUB is purple!)

## versions

Grub has 2 versions

- 0.97, usually known just as GRUB, or Legacy GRUB.
- Grub >= 2, which is backwards incompatible, and has more features.

    grub 2 is still beta.

Some distros like Ubuntu have already adopted GRUB 2,
while others are still using GRUB for stability concerns.

Determine your GRUB version with:

    grub-install -v

Here we discuss GRUB 2.

---

The MBR is too small for all the features that GRUB developers wanted,
so they use it only to transfer control to another larger code section.

## configuration

The main grub file is `/boot/grub/grub.cfg`.

It is automatically generated by grub-mkconfig using templates
from /etc/grub.d and settings from /etc/default/grub

The main job for grub userspace utilities is to look at the config files,
and then transfer the config information to the correct locations on the hard disk,
where BIOS will be able to find them.

To edit the boot configs:

    sudo vim /etc/default/grub

- `GRUB_DEFAULT`: default os choice if cursor is not moved.

	starts from 0, the order is the same as shown at grub os choice menu

- `GRUB_TIMEOUT` : time before auto OS choice in seconds

after changing the configs you need to:

    sudo update-grub

Things GRUB must know for how to do its job include:

- which partition to use
- in that partition, which directory to look into for the boot information.

By default on Linux this is `/boot/`

TODO grub install

## sources

great configuration tutorial: <http://www.dedoimedo.com/computers/grub-2.html>

# boot directory

By default is located at `/boot/`

It contains the following files:

- vmlinz-VERSION: the kernel compiled code, also knows as kernel image.

- config-VERSION: the kernel configuration options,
    generated at configuration before kernel compilation by `make menuconfig`

- abi-VERSION: TODO what is? looks like the kernel symbol table of exported symbols.

# init

First user-space process and parent of all processes!

It has pid 1.

It is the first child of the first kernel process, which has pid 0.

Last thing that is run at boot process.

Determines runlevel.

A great way to understand what happens after `init` is to use `pstree`.

This is distribution dependant.

# run levels

TODO understand better

Set runlevel to 6 which implies a reboot

Get current runlevel (POSIX 7):

    who -r

Therefore this is a POSIX 7 supported concept.

Set runlevel:

    #sudo init 6

Attention: this would cause the system to reboot.

# upstart

some systems such as Ubunutu use upstart, newer replacement to the `system v` init system

- `/etc/init`: upstart configuration files

	programs here are named services

- `/etc/init.d`: compatibility only system v rc dirs

	links to programs that get run on each runlevel at `/etc/rc\n.d/`

## service

Upstart interface to services.

Get status of all services:

    sudo service --status-all

Legend:

- `+`: started
- `-`: stopped
- `?`: unknow

    sudo service apache2 status
    sudo status apache2

    sudo service apache2 start
    sudo start apache2

    sudo service apache2 stop
    sudo stop apache2

    sudo service apache2 restart
    sudo restart apache2

TODO `service restart` vs `restart`?
